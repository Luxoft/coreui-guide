



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="guide to the core ui architecture for QML driven projects">
      
      
      
        <meta name="author" content="Juergen Ryannel">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Runtime & Modules - QML Core UI</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700|Ubuntu+Mono&display=fallback">
        <style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#runtime-modules" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="QML Core UI" class="md-header-nav__button md-logo">
          
            <i class="md-icon">bookmark</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              QML Core UI
            </span>
            <span class="md-header-nav__topic">
              
                Runtime & Modules
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/Luxoft/qml-coreui-guide/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Overview
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../guide/whatis/" class="md-tabs__link">
          Guide
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../foundations/" class="md-tabs__link md-tabs__link--active">
          Topics
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../admin/intro/" class="md-tabs__link">
          Admin
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../download/" class="md-tabs__link">
          Download
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../extensions/overview/" class="md-tabs__link">
          Extensions
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../resources/" class="md-tabs__link">
          Resources
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../support/" class="md-tabs__link">
          Support This
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="QML Core UI" class="md-nav__button md-logo">
      
        <i class="md-icon">bookmark</i>
      
    </a>
    QML Core UI
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/Luxoft/qml-coreui-guide/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/whatis/" title="What is Core UI" class="md-nav__link">
      What is Core UI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/install/" title="Install" class="md-nav__link">
      Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/start/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/cookbook/" title="CookBook" class="md-nav__link">
      CookBook
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/examples/" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Topics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Topics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../foundations/" title="Foundations" class="md-nav__link">
      Foundations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../blocks/" title="Building Blocks" class="md-nav__link">
      Building Blocks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../controls/" title="Controls" class="md-nav__link">
      Controls
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fslayout/" title="Filesystem layout" class="md-nav__link">
      Filesystem layout
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../layouts/" title="Layouts" class="md-nav__link">
      Layouts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../prototyping/" title="Protoyping" class="md-nav__link">
      Protoyping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../services/" title="Services" class="md-nav__link">
      Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../testing/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../uilayer/" title="UI Layer" class="md-nav__link">
      UI Layer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../refactor/" title="Refactoring" class="md-nav__link">
      Refactoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../styles/" title="Styles" class="md-nav__link">
      Styles
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Runtime & Modules
      </label>
    
    <a href="./" title="Runtime & Modules" class="md-nav__link md-nav__link--active">
      Runtime & Modules
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#engine" class="md-nav__link">
    Engine
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plugin-extensions" class="md-nav__link">
    Plugin Extensions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#object-patterns" class="md-nav__link">
    Object Patterns
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instances-vs-singletons" class="md-nav__link">
    Instances vs Singletons
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delayed-init" class="md-nav__link">
    Delayed Init
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Admin
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Admin
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/intro/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/install/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/build/" title="Building" class="md-nav__link">
      Building
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/dev/" title="Developing" class="md-nav__link">
      Developing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/projects/" title="Project Creation" class="md-nav__link">
      Project Creation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/reference/" title="Reference" class="md-nav__link">
      Reference
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Download
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Download
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../download/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Extensions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Extensions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../extensions/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Resources
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Resources
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../resources/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Support This
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Support This
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../support/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#engine" class="md-nav__link">
    Engine
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plugin-extensions" class="md-nav__link">
    Plugin Extensions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#object-patterns" class="md-nav__link">
    Object Patterns
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instances-vs-singletons" class="md-nav__link">
    Instances vs Singletons
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delayed-init" class="md-nav__link">
    Delayed Init
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Luxoft/qml-coreui-guide/edit/master/docs/topics/runtime.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="runtime-modules">Runtime &amp; Modules</h1>
<p>The QML runtime used in the CoreUI architecture is Qt Application Manager. Which is designed to provide a multi-process architecture, where each application runs in an own process, started by its own runtime.</p>
<h2 id="engine">Engine</h2>
<p>A runtime is just a small C++ application starting the JS engine and QML engine and loading the initial qml document.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;QGuiApplication&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;QQmlApplicationEngine&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="n">QGuiApplication</span> <span class="n">app</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="n">QQmlApplicationEngine</span> <span class="n">engine</span><span class="p">(</span><span class="s">&quot;main.qml&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">app</span><span class="p">.</span><span class="n">exec</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>The QML application engine in the background handles the quit signal, loads translations, handles windows correctly and setups a QML file selector.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you look for more inspiration how to write a custom runtime check out <code>$QTSRC/qtdeclarative/tools/qmlscene</code>. This runtime provides also command line parsing, import path configuration, etc...</p>
</div>
<p>The Qt Application Manager is more complex as contains a lot more features, configuration capabilities and security mechanisms as also support for launching other runtimes in separate processes and watching over them.</p>
<h2 id="plugin-extensions">Plugin Extensions</h2>
<p>A runtime is extended using QtQuick plugins. A plugin is a defined C++ interface to be implemented and the plugin library needs to placed in a defined folder structure with a small description file the <code>qmldir</code>. Qt Creator contains a wizard to create a plugin. The CoreUI admin also has a generator, which fits the plugin into the existing native project.</p>
<p>When build and installed, te runtime will load the plugin when the module import is the first time requested by a QML document. By this we can control the loading of plugins by ensuring the module is only loaded when required. The runtime lookups the QML import declaration in the import paths and when detected loads the corresponding plugin library. The plugin declares a set of QML types which are then registered into the module namespace and made available to the QML engine.</p>
<p>Like below code which provides the interface vor the plugin to register the QML types.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// plugin.h</span>
<span class="cp">#pragma once</span>

<span class="cp">#include</span> <span class="cpf">&lt;QtQml&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">AlarmPlugin</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QQmlExtensionPlugin</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>
    <span class="n">Q_PLUGIN_METADATA</span><span class="p">(</span><span class="n">IID</span> <span class="n">QQmlExtensionInterface_iid</span><span class="p">)</span>

<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">registerTypes</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">uri</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>

<p>A type is registered using one of the <code>qmlRegister...</code> template methods. By this this object is now accessible under the import URL with the type name in QML.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;plugin.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;teatimer.h&quot;</span><span class="cp"></span>


<span class="kt">void</span> <span class="n">TeaTimerPlugin</span><span class="o">::</span><span class="n">registerTypes</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">uri</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Q_ASSERT</span><span class="p">(</span><span class="n">uri</span> <span class="o">==</span> <span class="n">QLatin1String</span><span class="p">(</span><span class="s">&quot;Tea&quot;</span><span class="p">));</span>
    <span class="n">qmlRegisterType</span><span class="o">&lt;</span><span class="n">TeaTimer</span><span class="o">&gt;</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;TeaTimer&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>The object registered can be either a visual type inheriting from <code>QtQuickItem</code> or a business type , inheriting from <code>QObject</code>. If the type shall take part of the rendering than it must inherit from <code>QQuickItem</code>.
Our example is a tea timer, which allows the user to set a duration and the time triggers a signal when the timer is done.</p>
<p>The tea timer is a standard object with properties and signals. Additionally <code>Q_INVOKABLE</code> is used to make the method available to QML.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#pragma once</span>

<span class="cp">#include</span> <span class="cpf">&lt;QtCore&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">TeaTimer</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QObject</span> <span class="p">{</span>
    <span class="n">Q_OBJECT</span>
    <span class="n">QPROPERTY</span><span class="p">(</span><span class="kt">int</span> <span class="n">currentTime</span> <span class="n">READ</span> <span class="n">currentTime</span> <span class="n">NOTIFY</span> <span class="n">currentTimeChanged</span><span class="p">)</span>
    <span class="n">Q_INVOKABLE</span> <span class="kt">void</span> <span class="n">set</span><span class="p">(</span><span class="kt">int</span> <span class="n">min</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sec</span><span class="p">);</span>
    <span class="n">Q_INVOKABLE</span> <span class="kt">void</span> <span class="nf">start</span><span class="p">();</span>
    <span class="n">Q_INVOKABLE</span> <span class="kt">void</span> <span class="nf">stop</span><span class="p">();</span>
    <span class="kt">int</span> <span class="nf">currentTime</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
    <span class="kt">void</span> <span class="nf">setCurrentTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">currentTime</span><span class="p">);</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">handleTick</span><span class="p">();</span>
<span class="nl">signals</span><span class="p">:</span>
    <span class="kt">void</span> <span class="n">currentTimeChanged</span><span class="p">();</span>
    <span class="kt">void</span> <span class="nf">ring</span><span class="p">();</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">QTimer</span> <span class="o">*</span><span class="n">m_timer</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">m_currentTime</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">m_duration</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>

<p>For the implementation the tea timer uses a QTimer which timeouts every 100msecs to forward the current time and when the duration is reached it rings.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// teatimer.cpp</span>
<span class="cp">#include</span> <span class="cpf">&quot;teatimer.h&quot;</span><span class="cp"></span>

<span class="n">TeaTimer</span><span class="o">::</span><span class="n">TeaTimer</span><span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
    <span class="o">:</span> <span class="n">QObject</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">m_timer</span><span class="p">(</span><span class="k">new</span> <span class="n">QTimer</span><span class="p">(</span><span class="k">this</span><span class="p">))</span>
    <span class="p">,</span> <span class="n">m_currentTime</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">connect</span><span class="p">(</span><span class="n">m_timer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">QTimer</span><span class="o">::</span><span class="n">timeout</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">TeaTimer</span><span class="o">::</span><span class="n">handleTick</span><span class="p">);</span>
    <span class="n">m_timer</span><span class="o">-&gt;</span><span class="n">setInterval</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// 100 msecs</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">TeaTimer</span><span class="o">::</span><span class="n">set</span><span class="p">(</span><span class="kt">int</span> <span class="n">min</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sec</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">stop</span><span class="p">();</span>
    <span class="n">m_duration</span> <span class="o">=</span>  <span class="p">(</span><span class="n">min</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="n">sec</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">TeaTimer</span><span class="o">::</span><span class="n">start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">m_timer</span><span class="o">-</span><span class="n">start</span><span class="p">();</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">TeaTimer</span><span class="o">::</span><span class="n">stop</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">m_timer</span><span class="o">-</span><span class="n">stop</span><span class="p">();</span>
    <span class="n">setCurrentTime</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">TeaTimer</span><span class="o">::</span><span class="n">handleTick</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">setCurrentTime</span><span class="p">(</span><span class="n">currentTime</span><span class="p">()</span> <span class="o">+</span> <span class="n">m_timer</span><span class="o">-&gt;</span><span class="n">interval</span><span class="p">());</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">TeaTimer</span><span class="o">::</span><span class="n">currentTime</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">m_currentTime</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">setCurrentTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">currentTime</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">m_currentTime</span> <span class="o">==</span> <span class="n">currentTime</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">m_currentTime</span> <span class="o">=</span> <span class="n">msec</span><span class="p">;</span>
    <span class="n">emit</span> <span class="nf">currentTimeChanged</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">m_currentTime</span> <span class="o">&gt;=</span> <span class="n">m_duration</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">stop</span><span class="p">();</span>
        <span class="n">emit</span> <span class="nf">ring</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>We can now use the tea timer inside our QML code through importing the tea module and instantiating the TeaTimer object.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nx">Tea</span> <span class="mf">1.0</span>

<span class="nx">MainWindow</span> <span class="p">{</span>
    <span class="kd">id: root</span>
    <span class="nx">TeaTimer</span> <span class="p">{</span>
        <span class="k">duration:</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">TeaTimer</span><span class="p">.</span><span class="nx">Minutes</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h2 id="object-patterns">Object Patterns</h2>
<h3 id="instances-vs-singletons">Instances vs Singletons</h3>
<p>QML also allows to register singletons. They are instantiated when the first time the module is imported. The problem with them are they are never destroyed and also they can be used anywhere in your code. Sounds great on first hand, but these singletons are tricky as they introduce dependencies which makes it hard to test these QML components. Ideally you try to avoid singletons wherever you can and use the dependency injections (aka configurable dependencies) to pass on instances of logic object into QML.</p>
<p>This is a bad example of using a tea timer type, by registering the type as singleton and using it inside a panel. Now it is very difficult to test this component.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// TeaPanel</span>
<span class="nx">Panel</span> <span class="p">{</span>
    <span class="nx">Label</span> <span class="p">{</span>
<span class="hll">        <span class="k">text:</span> <span class="nx">TeaTimer</span><span class="p">.</span><span class="nx">currentTime</span>
</span>    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>This is better, we have the incoming dependency under control.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// TeaPanel</span>
<span class="nx">Panel</span> <span class="p">{</span>
<span class="hll">    <span class="nx">property</span> <span class="nx">TeaTimer</span> <span class="nx">teaTimer</span>
</span>    <span class="nx">Label</span> <span class="p">{</span>
<span class="hll">        <span class="k">text:</span> <span class="nx">teaTimer</span><span class="p">.</span><span class="nx">currentTime</span>
</span>    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Even better, avoid the dependency on the type at all</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// TeaPanel.qml</span>
<span class="nx">Panel</span> <span class="p">{</span>
    <span class="kd">id: root</span>
<span class="hll">    <span class="nx">property</span> <span class="kr">int</span> <span class="nx">currentTime</span>
</span>    <span class="nx">Label</span> <span class="p">{</span>
<span class="hll">        <span class="k">text:</span> <span class="nx">root</span><span class="p">.</span><span class="nx">currentTime</span>
</span>    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="delayed-init">Delayed Init</h3>
<p>Also when using instances we need to ensure the instantiation goes fast as this directly relates to the UI startup. Which means the constructor must be slim. Any longer startup (e.g. pinging a server) should be done using a delayed init call.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">TeaTimer</span><span class="o">::</span><span class="n">TeaTimer</span><span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
    <span class="o">:</span> <span class="n">QObject</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
<span class="hll">    <span class="n">QTimer</span><span class="o">::</span><span class="n">singleshot</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">TeaTimer</span><span class="o">::</span><span class="n">init</span><span class="p">);</span>
</span><span class="p">}</span>

<span class="n">TeaTimer</span><span class="o">::</span><span class="n">init</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// do long initialization</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../styles/" title="Styles" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Styles
              </span>
            </div>
          </a>
        
        
          <a href="../../admin/intro/" title="Introduction" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Introduction
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            2019 Luxoft GmbH
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>
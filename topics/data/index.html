



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="guide to the core ui architecture for QML driven projects">
      
      
      
        <meta name="author" content="Juergen Ryannel">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Exposing Data to QML - QML Core UI</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700|Ubuntu+Mono&display=fallback">
        <style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#exposing-data-to-qml" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="QML Core UI" class="md-header-nav__button md-logo">
          
            <i class="md-icon">bookmark</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              QML Core UI
            </span>
            <span class="md-header-nav__topic">
              
                Exposing Data to QML
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/Luxoft/qml-coreui-guide/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../guide/overview/" class="md-tabs__link">
          Tutorial
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../foundations/" class="md-tabs__link md-tabs__link--active">
          Topics
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../admin/intro/" class="md-tabs__link">
          Admin CLI
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="QML Core UI" class="md-nav__button md-logo">
      
        <i class="md-icon">bookmark</i>
      
    </a>
    QML Core UI
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/Luxoft/qml-coreui-guide/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/install/" title="Install" class="md-nav__link">
      Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/start/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/cookbook/" title="CookBook" class="md-nav__link">
      CookBook
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/examples/" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Topics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Topics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../foundations/" title="Foundations" class="md-nav__link">
      Foundations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../blocks/" title="Building Blocks" class="md-nav__link">
      Building Blocks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../uilayer/" title="UI Layer" class="md-nav__link">
      UI Layer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fslayout/" title="Filesystem layout" class="md-nav__link">
      Filesystem layout
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../runtime/" title="Runtime & Modules" class="md-nav__link">
      Runtime & Modules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kind/" title="Kind of Components" class="md-nav__link">
      Kind of Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../controls/" title="Controls" class="md-nav__link">
      Controls
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../services/" title="Services" class="md-nav__link">
      Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../testing/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../styles/" title="Styles" class="md-nav__link">
      Styles
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../layouts/" title="Layouts" class="md-nav__link">
      Layouts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../prototyping/" title="Protoyping" class="md-nav__link">
      Protoyping
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Exposing Data to QML
      </label>
    
    <a href="./" title="Exposing Data to QML" class="md-nav__link md-nav__link--active">
      Exposing Data to QML
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#exposing-data" class="md-nav__link">
    Exposing Data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-or-c" class="md-nav__link">
    JSON or C++
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mechanics-of-exposure" class="md-nav__link">
    Mechanics of Exposure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demo-for-discussions" class="md-nav__link">
    Demo for Discussions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-manager-api" class="md-nav__link">
    Task Manager API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c-data-sources" class="md-nav__link">
    C++ Data Sources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-an-api" class="md-nav__link">
    Using an API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#streamlining-the-api" class="md-nav__link">
    Streamlining the API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure-and-rules" class="md-nav__link">
    Structure and Rules
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../workflow/" title="Design Work Flow" class="md-nav__link">
      Design Work Flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reload/" title="(Live) Reloading" class="md-nav__link">
      (Live) Reloading
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../refactor/" title="Refactoring" class="md-nav__link">
      Refactoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../principles/" title="Design Principles" class="md-nav__link">
      Design Principles
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Admin CLI
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Admin CLI
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/intro/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/build/" title="Building" class="md-nav__link">
      Building
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/dev/" title="Developing" class="md-nav__link">
      Developing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/projects/" title="Project Creation" class="md-nav__link">
      Project Creation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/reference/" title="Reference" class="md-nav__link">
      Reference
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#exposing-data" class="md-nav__link">
    Exposing Data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-or-c" class="md-nav__link">
    JSON or C++
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mechanics-of-exposure" class="md-nav__link">
    Mechanics of Exposure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demo-for-discussions" class="md-nav__link">
    Demo for Discussions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-manager-api" class="md-nav__link">
    Task Manager API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c-data-sources" class="md-nav__link">
    C++ Data Sources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-an-api" class="md-nav__link">
    Using an API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#streamlining-the-api" class="md-nav__link">
    Streamlining the API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure-and-rules" class="md-nav__link">
    Structure and Rules
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Luxoft/qml-coreui-guide/edit/master/docs/topics/data.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="exposing-data-to-qml">Exposing Data to QML</h1>
<blockquote>
<p>A clever person solves a problem.
A wise person avoids it.</p>
<p>-- Einstein</p>
</blockquote>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This chapter will show you how to expose the different ways of exposing data to the user interface layer and tries to develop
a strategy to streamline the data exposure. We will shortly discuss the pros and cons of each strategy and later define a strategy which can scale.</p>
</div>
<h2 id="exposing-data">Exposing Data</h2>
<p>Qt offers you several ways to inject data into the user interface presented by QML. QML comes with native support for JSON data using the JavaScript <code>JSON.parse</code> and <code>JSON.stringify</code> methods. As a transport you can use HTTP via the XMLHTTRequest or for web-sockets using the WebSocket library. Here is a list of references:</p>
<ul>
<li><a href="https://doc.qt.io/qt-5/qtqml-xmlhttprequest-example.html">https://doc.qt.io/qt-5/qtqml-xmlhttprequest-example.html</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON</a></li>
<li><a href="https://doc.qt.io/qt-5/qml-qtwebsockets-websocket.html">https://doc.qt.io/qt-5/qml-qtwebsockets-websocket.html</a></li>
</ul>
<p>The other option is to capture the data on the native C++ side expose it to QML using <code>qmlRegisterType</code> and properties, slots and signals. For this the Qt C++ data types need to be transformed to QML supported data types. The process of registering C++ data types and the conversion are discussed in the Qt documentation at several places.</p>
<p>Here is a longer list of relevant sections.</p>
<ul>
<li><a href="https://doc.qt.io/qt-5/qtqml-index.html">QtQml</a><ul>
<li><a href="https://doc.qt.io/qt-5/qtqml-cppintegration-overview.html">Overview - QML and C++ Integration</a></li>
<li><a href="https://doc.qt.io/qt-5/qtqml-cppintegration-topic.html">Integrating QML and C++</a><ul>
<li><a href="https://doc.qt.io/qt-5/qtqml-cppintegration-exposecppattributes.html">Exposing Attributes of C++ Types to QML</a></li>
<li><a href="https://doc.qt.io/qt-5/qtqml-cppintegration-definetypes.html">Defining QML Types from C++</a></li>
<li><a href="https://doc.qt.io/qt-5/qtqml-cppintegration-contextproperties.html">Embedding C++ Objects into QML with Context Properties</a></li>
<li><a href="https://doc.qt.io/qt-5/qtqml-cppintegration-interactqmlfromcpp.html">Interacting with QML Objects from C++</a></li>
<li><a href="https://doc.qt.io/qt-5/qtqml-cppintegration-data.html">Data Type Conversion Between QML and C++</a></li>
</ul>
</li>
<li><a href="https://doc.qt.io/qt-5/qtqml-tutorials-extending-qml-example.html">Writing QML Extensions with C++</a></li>
<li><a href="https://doc.qt.io/qt-5/qtqml-modules-cppplugins.html">Creating C++ Plugins for QML</a></li>
<li><a href="https://doc.qt.io/qt-5/qtqml-cppclasses-topic.html">Important C++ Classes Provided By The Qt QML Module</a></li>
</ul>
</li>
<li><a href="https://doc.qt.io/qt-5/qtquick-index.html">QtQuick</a><ul>
<li><a href="https://doc.qt.io/qt-5/qtquick-module.html">Qt Quick C++ Classes</a></li>
<li><a href="https://doc.qt.io/qt-5/qtquick-cppextensionpoints.html">C++ Extension Points Provided By Qt Quick</a></li>
</ul>
</li>
<li><a href="https://doc.qt.io/qt-5/qtquickcontrols-index.html">QtQuick.Controls 2</a><ul>
<li><a href="https://doc.qt.io/qt-5/qtquickcontrols2-module.html">Qt Quick Controls C++ Classes</a></li>
</ul>
</li>
</ul>
<h2 id="json-or-c">JSON or C++</h2>
<p>JSON is a great data format when you interact with HTTP REST endpoints or other cloud based services which are JSON based. When using Qt C++ you would need to rely on <code>QNetworkAccessManager</code> and <code>QJSonDocument</code> to consume such kind of services. There are 3rd party libraries which makes it easier to consume a HTTP REST endpoint on the QML side for example duperagent (<a href="https://github.com/Cutehacks/duperagent">https://github.com/Cutehacks/duperagent</a>).</p>
<p>When trying to expose JSON directly to the QML side using QtC++ it might be better to just expose the <code>QByteArray</code> to QML and let JavaScript to convert it to a JSON data type using <code>JSON.parse</code>. In pure QML you would have to use the XmlHttpRequest and convert the incoming data into JSON. This is pretty low level when coming from the web development and are used to other libraries like axios.</p>
<p>From the C++ side you would use the <code>QNetworkAccessManager</code> and request a HTTP endpoint and convert the data into JSON using <code>QJsonDocument</code>. From there you normally convert it further to a QML supported types or other data structures to expose it to QML or using C++ native data types.</p>
<p>If your data comes from another native source using a binary protocol you often have to write an adapter layer to convert the data types from standard C++ to Qt C++ and then you can directly expose this data to QML using Qt offered data conversions.</p>
<h2 id="mechanics-of-exposure">Mechanics of Exposure</h2>
<p>When you have the data as Qt C++ native types, you want to expose it to QML. But how best to approach this?</p>
<p>We can see data as a structured tree which starts either with an object or an array. JSON demonstrated very nicely that all data can be reduced to simple data structures or primitive type and object or arrays. Same can be applied to Qt data. But data is not everything we want to expose, we also want to expose behavior in the form of operations on the data as also signals as notifications about changes. Additional Qt provides reactive programming, where an API consumer gets notified when a property has changed and which leads to data binding. It is only possible to bind to properties, not to operations or signals. On signals you can connect using a handler, which is just another form of callback. Operations might trigger property changes through the procedure or writing to a property will also trigger a property change.</p>
<p>Besides these structures there is also the item model type in Qt. Which is a protocol to expose data arrays efficient to a view which expects a model.</p>
<h2 id="demo-for-discussions">Demo for Discussions</h2>
<p>To demonstrate the capabilities and possible issues we will develop a small configuration loader for a task list with a timer attached. The idea is you work on a task for x minutes, make a break and then continue to work on anther task. After some work unites you make a longer break.</p>
<p>The configuration is stored in a JSON document and looks like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF0000&quot;</span><span class="p">,</span>
    <span class="nt">&quot;tasks&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;task-1&quot;</span><span class="p">,</span> <span class="nt">&quot;done&quot;</span><span class="p">:</span> <span class="kc">false</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;task-2&quot;</span><span class="p">,</span> <span class="nt">&quot;done&quot;</span><span class="p">:</span> <span class="kc">false</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;task-3&quot;</span><span class="p">,</span> <span class="nt">&quot;done&quot;</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;timing&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;work&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
        <span class="nt">&quot;short-break&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="nt">&quot;long-break&quot;</span><span class="p">:</span> <span class="mi">15</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>In the UI we would like to display the configuration and modify it. For example we would like to:</p>
<ul>
<li>change the color to another random color</li>
<li>add new tasks to the task list</li>
<li>clear out all done tasks</li>
<li>mark task to be done</li>
<li>update a task text</li>
<li>change the individual timing settings</li>
</ul>
<p>As we need to use this information in different places we would like to get informed when any of these data fields change.</p>
<h2 id="task-manager-api">Task Manager API</h2>
<p>The data could come from a network service using HTTP or we could read it from a NOSQL DB, or simple from a JSON file. Using a JSON file is the simplest way.</p>
<p>We would read the text document and use QJSonDocument to convert it into a QJsonObject and form there into a QVariantMap. From there on we have two options, either expose the whole document as a great QVariantMap or expose individual properties as a QVariant related type.</p>
<p>Exposing the whole document:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">TodoManager</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QObject</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">QVariantMap</span> <span class="n">document</span> <span class="n">READ</span> <span class="n">document</span> <span class="n">WRITE</span> <span class="n">setDocument</span> <span class="n">NOTIFY</span> <span class="n">documentChanged</span><span class="p">)</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Or exposing the individual properties</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">TodoManager</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QObject</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">QColor</span> <span class="n">color</span> <span class="n">READ</span> <span class="n">color</span> <span class="n">WRITE</span> <span class="n">setColor</span> <span class="n">NOTIFY</span> <span class="n">colorChanged</span><span class="p">)</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">QVariantList</span> <span class="n">tasks</span> <span class="n">READ</span> <span class="n">tasks</span> <span class="n">WRITE</span> <span class="n">setTasks</span> <span class="n">NOTIFY</span> <span class="n">tasksChanged</span><span class="p">)</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">QVariantMap</span> <span class="n">timing</span> <span class="n">READ</span> <span class="n">timing</span> <span class="n">WRITE</span> <span class="n">setTiming</span> <span class="n">NOTIFY</span> <span class="n">timingChanged</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Now we can get and set the data. Almost done.</p>
<h2 id="c-data-sources">C++ Data Sources</h2>
<p>If we would have C++ native data structures we would first write an adapter, before we can expose the data to Qt C++. The adapter could look like this.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">struct</span> <span class="n">Task</span> <span class="p">{</span>
    <span class="n">QString</span> <span class="n">text</span>
    <span class="kt">bool</span> <span class="n">done</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">Timing</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">work</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">shortBreak</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">longBreak</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">TodoEngine</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QObject</span> <span class="p">{</span>
    <span class="n">Q_OBJECT</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">TodoEngine</span><span class="p">(</span><span class="n">QObject</span> <span class="o">*</span><span class="n">parent</span><span class="o">=</span><span class="k">nullptr</span><span class="p">);</span>
    <span class="n">QColor</span> <span class="nf">color</span><span class="p">();</span>
    <span class="kt">void</span> <span class="nf">setColor</span><span class="p">(</span><span class="n">QColor</span> <span class="n">color</span><span class="p">);</span>
    <span class="n">QList</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">tasks</span><span class="p">();</span>
    <span class="kt">void</span> <span class="nf">appendTask</span><span class="p">(</span><span class="n">Task</span> <span class="n">task</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">clearTasks</span><span class="p">();</span>
    <span class="n">Timing</span> <span class="nf">timing</span><span class="p">();</span>
    <span class="kt">void</span> <span class="nf">setTimming</span><span class="p">(</span><span class="n">Timing</span> <span class="n">t</span><span class="p">);</span>

<span class="nl">signals</span><span class="p">:</span>
    <span class="kt">void</span> <span class="n">dataChanged</span><span class="p">();</span>
<span class="k">private</span><span class="o">:</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>

<p>This engine is using an C++ internal task implementation which is need to be adapted to be easy consumable for Qt. This engine API is not directly exposed to QML, we need to wrap it another time to ensure we provide a great experience.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">TimingGroupedProperty</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QObject</span> <span class="p">{</span>
    <span class="n">Q_OBJECT</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="kt">int</span> <span class="n">work</span> <span class="n">READ</span> <span class="n">work</span> <span class="n">WRITE</span> <span class="n">setWork</span> <span class="n">NOTIFY</span> <span class="n">workChanged</span><span class="p">)</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="kt">int</span> <span class="n">shortBreak</span> <span class="n">READ</span> <span class="n">shortBreak</span> <span class="n">WRITE</span> <span class="n">setShortBreak</span> <span class="n">NOTIFY</span> <span class="n">workChanged</span><span class="p">)</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="kt">int</span> <span class="n">longBreak</span> <span class="n">READ</span> <span class="n">longBreak</span> <span class="n">WRITE</span> <span class="n">setLongBreak</span> <span class="n">NOTIFY</span> <span class="n">longBreakChanged</span><span class="p">)</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">TodoManager</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QObject</span> <span class="p">{</span>
    <span class="n">Q_OBJECT</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">QColor</span> <span class="n">color</span> <span class="n">READ</span> <span class="n">color</span> <span class="n">WRITE</span> <span class="n">setColor</span> <span class="n">notify</span> <span class="n">colorChanged</span><span class="p">)</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">QVariantList</span> <span class="n">task</span> <span class="n">READ</span> <span class="n">tasks</span> <span class="n">WRITE</span> <span class="n">setTasks</span> <span class="n">notify</span> <span class="n">tasksChanged</span><span class="p">)</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">TimingGroupedProperty</span><span class="o">*</span> <span class="n">timing</span> <span class="n">READ</span> <span class="n">timing</span> <span class="n">CONSTANT</span><span class="p">)</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>To make the list even better consumable we could introduce a model.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">TaskModel</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QAbstractItemListModel</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">TodoManager</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QObject</span> <span class="p">{</span>
    <span class="n">Q_OBJECT</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">QColor</span> <span class="n">color</span> <span class="n">READ</span> <span class="n">color</span> <span class="n">WRITE</span> <span class="n">setColor</span> <span class="n">notify</span> <span class="n">colorChanged</span><span class="p">)</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">TaskModel</span><span class="o">*</span> <span class="n">tasks</span> <span class="n">READ</span> <span class="n">tasks</span> <span class="n">CONSTANT</span><span class="p">)</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">TimingGroupedProperty</span><span class="o">*</span> <span class="n">timing</span> <span class="n">READ</span> <span class="n">timing</span> <span class="n">CONSTANT</span><span class="p">)</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>The model could be editable by implementing <code>setData</code> and we would be able to assign values from inside QML.</p>
<p>Now we should assume the API is perfect and can be used by the QML frontend developers.</p>
<h2 id="using-an-api">Using an API</h2>
<p>We should now remember about our use cases and see how a frontend developer would use our API.</p>
<ul>
<li>change the color to another random color</li>
<li>add new tasks from the task list</li>
<li>clear out all done tasks</li>
<li>mark task to be done</li>
<li>update a task text</li>
<li>change the individual timing settings</li>
</ul>
<p>So lets see how the frontend developer would use the API. For this we can assume a simple UI where the TodoManager is instantiated and we implement a button on clicked handler.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">Pane</span> <span class="p">{</span>
    <span class="nx">TodoManager</span> <span class="p">{</span>
        <span class="kd">id: manager</span>
    <span class="p">}</span>
    <span class="nx">Button</span> <span class="p">{</span>
        <span class="k">text:</span> <span class="s1">&#39;Action&#39;</span>
        <span class="k">onClicked:</span> <span class="nx">doIt</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">doIt</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// here comes our code</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>change the color to another random color</p>
</blockquote>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">doIt</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">manager</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">rgba</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>add new tasks to the task list</p>
</blockquote>
<p>This is currently not supported, we would have to extend the model for an append function. But which parameters would the append function take?</p>
<p>If this would be a gadget, we can not create a gadget on the QML side, another option would be to pass in a <code>QVariantMap</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">doIt</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// using a QVariantMap</span>
    <span class="nx">manager</span><span class="p">.</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">append</span><span class="p">({</span><span class="k">text:</span> <span class="s2">&quot;Another Task&quot;</span><span class="p">,</span> <span class="k">done:</span> <span class="kc">false</span><span class="p">})</span>
    <span class="c1">// individual parameters</span>
    <span class="nx">manager</span><span class="p">.</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;Another Task&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>clear out all done tasks</p>
</blockquote>
<p>Also our current model does not support it yet, we have to add a clear function.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">doIt</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// using a QVariantMap</span>
    <span class="nx">manager</span><span class="p">.</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>mark an individual task to be done</p>
</blockquote>
<p>If we would be in a ListView we would have access to an individual model entry</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">delegate:</span> <span class="nx">ItemDelegate</span> <span class="p">{</span>
    <span class="k">onClicked:</span> <span class="p">{</span>
        <span class="nx">model</span><span class="p">.</span><span class="nx">done</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>If not, then we would need to implement an set function, which will take a field map and an index.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">doIt</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">manager</span><span class="p">.</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="p">{</span> <span class="k">done:</span> <span class="kc">true</span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>update a task text</p>
</blockquote>
<p>We can again use our set method</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">doIt</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">manager</span><span class="p">.</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="p">{</span> <span class="k">text:</span> <span class="s2">&quot;hello&quot;</span> <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>or inside our list view the model assignment</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">delegate:</span> <span class="nx">Item</span> <span class="p">{</span>
    <span class="nx">model</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>change the individual timing settings</p>
</blockquote>
<p>To change the data we can use the grouped properties to access them.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">doIt</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">manager</span><span class="p">.</span><span class="nx">timing</span><span class="p">.</span><span class="nx">work</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span> <span class="c1">// set to 15 mins</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h2 id="streamlining-the-api">Streamlining the API</h2>
<p>This API requires currently quit some thinking to ensure all data is exposed to the users in the correct way and easy accessible to the frontend.</p>
<p>To streamline the API we could make the data read only and expose operations to support the different use case.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">TodoManager</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QObject</span> <span class="p">{</span>
    <span class="n">Q_OBJECT</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">QVariant</span> <span class="n">color</span> <span class="n">READ</span> <span class="n">color</span> <span class="n">notify</span> <span class="n">colorChanged</span><span class="p">)</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">QVariantModel</span><span class="o">*</span> <span class="n">tasks</span> <span class="n">READ</span> <span class="n">tasks</span> <span class="n">CONSTANT</span><span class="p">)</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">QVariantMap</span><span class="o">*</span> <span class="n">timing</span> <span class="n">READ</span> <span class="n">timing</span> <span class="n">notify</span> <span class="n">timingChanged</span><span class="p">)</span>
    <span class="p">...</span>
<span class="k">public</span> <span class="nl">slots</span><span class="p">:</span>
    <span class="c1">// set random color</span>
    <span class="kt">void</span> <span class="n">setRandomColor</span><span class="p">();</span>
    <span class="c1">// add task to task list</span>
    <span class="kt">void</span> <span class="nf">addTask</span><span class="p">(</span><span class="k">const</span> <span class="n">QVariantMap</span> <span class="o">&amp;</span><span class="n">task</span><span class="p">);</span>
    <span class="c1">// clear all done tasks</span>
    <span class="kt">void</span> <span class="nf">clearDoneTasks</span><span class="p">();</span>
    <span class="c1">// update text or done on task</span>
    <span class="kt">void</span> <span class="nf">updateTask</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="k">const</span> <span class="n">QVariantMap</span> <span class="o">&amp;</span><span class="n">fields</span><span class="p">);</span>
    <span class="c1">// mark task done</span>
    <span class="kt">void</span> <span class="nf">markTaskDone</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">);</span>
    <span class="c1">// update a timing value</span>
    <span class="kt">void</span> <span class="nf">updateTiming</span><span class="p">(</span><span class="n">QVariantMap</span> <span class="n">fields</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>This API now very generic. Maybe a little bit too generic.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Task</span> <span class="p">{</span>
    <span class="n">Q_GADGET</span>
    <span class="p">...</span>
<span class="p">};</span>


<span class="k">class</span> <span class="nc">Timing</span> <span class="p">{</span>
    <span class="n">Q_GADGET</span>
    <span class="p">...</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">TodoManager</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QObject</span> <span class="p">{</span>
    <span class="n">Q_OBJECT</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">QColor</span> <span class="n">color</span> <span class="n">READ</span> <span class="n">color</span> <span class="n">NOTIFY</span> <span class="n">colorChanged</span><span class="p">)</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">TaskModel</span><span class="o">*</span> <span class="n">tasks</span> <span class="n">READ</span> <span class="n">tasks</span> <span class="n">CONSTANT</span><span class="p">)</span>
    <span class="n">Q_PROPERTY</span><span class="p">(</span><span class="n">Timing</span> <span class="n">timing</span> <span class="n">READ</span> <span class="n">timing</span> <span class="n">NOTIFY</span> <span class="n">timingChanged</span><span class="p">)</span>
    <span class="p">...</span>
<span class="k">public</span> <span class="nl">slots</span><span class="p">:</span>
    <span class="c1">// set random color</span>
    <span class="kt">void</span> <span class="n">setRandomColor</span><span class="p">();</span>
    <span class="c1">// add task to task list</span>
    <span class="kt">void</span> <span class="nf">addTask</span><span class="p">(</span><span class="k">const</span> <span class="n">QVariantMap</span> <span class="o">&amp;</span><span class="n">task</span><span class="p">);</span>
    <span class="c1">// clear all done tasks</span>
    <span class="kt">void</span> <span class="nf">clearDoneTasks</span><span class="p">();</span>
    <span class="c1">// update text or done on task</span>
    <span class="kt">void</span> <span class="nf">updateTask</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="k">const</span> <span class="n">QVariantMap</span> <span class="o">&amp;</span><span class="n">fields</span><span class="p">);</span>
    <span class="c1">// mark task done</span>
    <span class="kt">void</span> <span class="nf">markTaskDone</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">);</span>
    <span class="c1">// update a timing value</span>
    <span class="kt">void</span> <span class="nf">updateTiming</span><span class="p">(</span><span class="n">QVariantMap</span> <span class="n">fields</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>The difference now is that the structures are concrete types, same as primitive types. When mutating the value, we can not use concrete types as there is no real way to create them from QML side. You could create a factory but the approach is much more complicated.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">doIt</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">task</span> <span class="o">=</span> <span class="nx">manager</span><span class="p">.</span><span class="nx">createTask</span><span class="p">()</span>
    <span class="nx">task</span><span class="p">.</span><span class="nx">done</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">manager</span><span class="p">.</span><span class="nx">updateTask</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">task</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>versus the JavaScript way</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">doIt</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">manager</span><span class="p">.</span><span class="nx">updateTask</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span> <span class="k">done:</span> <span class="kc">true</span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>The second one is much more accessible for a JavaScript developer. Also if this means a JS developer could add fields which do not exist in the structure.</p>
<p>Often backend developers are sidetracked by the different options Qt offers you to expose data to C++. The risk is high to get lost in the details and try to come up with a highly flexible data access patterns. When doing so developers loose sight on how a front-end developer would have to use then the API inside QML. It is important to make an API as accessible and narrow as possible for the API user by not focusing on access patterns and more on API use cases. By this the API will hide the business logic from QML inside C++ and only expose an API to QML which most of the time can be used in a single line of code and is often self explanatory.</p>
<h2 id="structure-and-rules">Structure and Rules</h2>
<p>To make API creation more scalable we need to define a clear structure and rules, which we can pass on to developers.</p>
<p>We want to separate state from mutations and queries. We define the state of an API as the sum of all properties. Actions are the methods which mutate the state, either directly or indirectly through a remote effect. And a query is a method which returns data. For reference see also:</p>
<ul>
<li><a href="https://martinfowler.com/bliki/CQRS.html">https://martinfowler.com/bliki/CQRS.html</a></li>
<li><a href="https://facebook.github.io/flux/">https://facebook.github.io/flux/</a></li>
<li><a href="https://graphql.org/learn/queries/">https://graphql.org/learn/queries/</a></li>
</ul>
<p>API State</p>
<ul>
<li>Expose primitive types using read only properties</li>
<li>Expose uncountable lists using read only models of either primitive types or structures presented by gadgets</li>
<li>Expose countable lists using a QVector or <code>QVariantList</code></li>
<li>Expose structured data through gadgets or <code>QVariantMap</code></li>
</ul>
<p>API Mutations or Queries</p>
<ul>
<li>Expose mutations using invokable methods</li>
<li>Pass in structured data through <code>QVariantMap</code></li>
<li>Pass in primitives using QML base types</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../prototyping/" title="Protoyping" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Protoyping
              </span>
            </div>
          </a>
        
        
          <a href="../workflow/" title="Design Work Flow" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Design Work Flow
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            2019 Luxoft GmbH
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>